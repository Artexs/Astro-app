name: Deploy and Release

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}
          tags: tag:ci
      
      - name: Test SSH Connection
        run: |
          ssh -o StrictHostKeyChecking=no \
              -o UserKnownHostsFile=/dev/null \
              ${{ secrets.SSH_USERNAME }}@${{ secrets.TS_SERVER_IP }} \
              'echo "SSH connection successful!"'
      
      # - name: Deploy Application
      #   run: |
      #     ssh -o StrictHostKeyChecking=no \
      #         -o UserKnownHostsFile=/dev/null \
      #         ${{ secrets.SSH_USERNAME }}@${{ secrets.TS_SERVER_IP }} << 'EOF'
      #       cd /path/to/your/app/on/server # IMPORTANT: Replace with the actual path to your application on the server
      #       git pull origin main
      #       npm install
      #       npm run build
      #       # Simple command to verify deployment. You can replace this with your actual application restart command.
      #       echo "Deployment successful at $(date)" > deployment_log.txt
      #     EOF
